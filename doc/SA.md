系統分析文件 (SA.md) - 點飲料點餐系統
一、系統概述與範疇 (System Scope)
本系統為一個前後端分離的飲品訂購平台。
• 核心目標：解決傳統點餐效率低落問題，提供數位化點餐、支付與追蹤功能。
• 系統邊界：
◦ 前台：顧客使用的網頁介面（瀏覽、點餐、追蹤）。
◦ 後台：店員與管理員使用的管理介面（接單、菜單管理、報表）。
◦ 排除範圍 (MVP 不包含)：外送地圖追蹤、會員積分制度、多店家系統（依據 REQ 未來擴充建議排除）。

--------------------------------------------------------------------------------
二、使用者角色與使用案例 (Actors & Use Cases)
根據 REQ 定義，系統包含三種主要角色。
1. 角色定義
   • 顧客 (Customer): 瀏覽菜單、客製化飲品、下單付款、查詢進度。
   • 店員 (Staff): 接收訂單、更改訂單狀態 (製作中/完工)、查詢歷史訂單。
   • 管理員 (Admin): 維護菜單資料、查看營收報表。
2. 核心使用案例 (Use Case Descriptions)
   • UC-01 點餐與結帳: 顧客選擇飲品規格並完成付款流程。
   • UC-02 訂單狀態更新: 店員接收訂單並依製作進度更新狀態，系統同步通知顧客。
   • UC-03 菜單維護: 管理員針對飲品進行上架、下架或修改價格。

--------------------------------------------------------------------------------
三、功能邏輯規格 (Functional Specifications)
此區段定義每個功能的「輸入、處理、輸出」，確保邏輯符合自我稽核規則中的「具體化」要求。
(1) 前台功能邏輯 (Frontend Logic)
功能編號
功能名稱
輸入 (Input)
處理邏輯 (Process)
輸出 (Output)
對應 REQ
F1
瀏覽菜單
顧客進入菜單頁
1. 查詢 menu_items 資料表<br>2. 篩選 is_available = true 的項目
   顯示飲品列表 (圖片/名稱/價格)
   F2
   客製化選項
   甜度、冰塊、加料
1. 驗證選項是否合法 (如: 不可選無糖又全糖)<br>2. 計算加料後的單品小計
   更新暫存購物車物件
   F3
   購物車管理
   商品 ID、數量
1. 檢查庫存/上架狀態<br>2. 彙總計算總金額 (total_amount)
   顯示購物車清單與總價
   F4
   結帳下單
   購物車內容、付款方式
1. 驗證付款資訊 (Mock)<br>2. 寫入 orders 與 order_items<br>3. 狀態設為 CREATED
   產生訂單編號，跳轉至追蹤頁
   F5
   訂單追蹤
   訂單編號
1. 查詢 orders 資料表狀態欄位
   顯示目前狀態 (如：準備中)
   (2) 後台功能邏輯 (Backend Logic)
   功能編號
   功能名稱
   輸入 (Input)
   處理邏輯 (Process)
   輸出 (Output)
   對應 REQ
   B1
   新訂單通知
   定時輪詢 (Polling)
1. 查詢 orders 中 status = CREATED 的資料
   顯示新訂單提示音或列表更新
   B2
   狀態管理
   訂單 ID、新狀態
1. 驗證店員權限<br>2. 更新 orders 資料表 status
   回傳更新成功，顧客端同步可見
   B4
   菜單管理
   飲品資訊 (名稱/價格/圖)
1. 驗證輸入格式<br>2. INSERT/UPDATE menu_items
   顯示操作成功訊息

--------------------------------------------------------------------------------
四、系統流程分析 (Process Flows)
依據「AI 自我稽核規則」第 10 點，流程需細化為 7-12 個步驟，包含前端、後端與資料庫行為。
流程 P1：顧客點餐與結帳流程 (Ordering Flow)
此流程對應 REQ P1。
1. [使用者] 進入首頁，點擊欲購買的飲品（例如：珍珠奶茶）。
2. [前端] 顯示彈出視窗，列出客製化選項（甜度：微糖、冰塊：去冰）。
3. [使用者] 選擇選項並點擊「加入購物車」。
4. [前端] 將商品資料暫存於 Client 端 State，計算小計並更新購物車圖示。
5. [使用者] 進入結帳頁面，選擇付款方式（LINE Pay），確認金額後點擊「送出訂單」。
6. [前端] 組合訂單 JSON 資料，發送 POST /api/orders 請求至後端。
7. [後端] 接收請求，驗證資料格式正確性（Check Validity）。
8. [資料庫] 在 orders 表建立主訂單，並在 order_items 表寫入多筆明細。
9. [後端] 確認寫入成功，回傳 HTTP 201 及 Order ID。
10. [前端] 接收成功回應，清除購物車暫存，轉導至「訂單追蹤頁面」。
    流程 P2：店員接單與製作流程 (Staff Fulfillment Flow)
    此流程對應 REQ P2, B1, B2。
1. [使用者] 店員登入後台系統，進入「接單介面」。
2. [前端] 系統自動（每 30 秒）發送請求查詢是否有 status = CREATED 的訂單。
3. [後端] 查詢資料庫，回傳新訂單列表。
4. [前端] 介面顯示「新訂單」卡片，店員點擊查看詳情（甜度冰塊）。
5. [使用者] 店員確認內容無誤，按下「開始製作」。
6. [前端] 發送 PATCH /api/orders/{id}/status，將狀態改為 PREPARING。
7. [資料庫] 更新該筆訂單的 status 欄位。
8. [使用者] 製作完成後，店員按下「通知取餐」。
9. [前端] 發送狀態更新請求，將狀態改為 COMPLETED。
10. [資料庫] 更新狀態，此時顧客若刷新追蹤頁面即可看到「可取餐」。

--------------------------------------------------------------------------------
五、資料需求分析 (Data Requirements)
根據 REQ 描述的實體 與 "雞娃娃飲料店" 範例，定義以下邏輯資料實體（Entity）：
1. Users (使用者):
   ◦ 儲存帳號、密碼、角色 (Admin/Staff/Customer)。
   ◦ 用途: 權限控管、登入驗證。
2. Menu_Items (菜單項目):
   ◦ 儲存名稱、描述、價格、圖片、分類、上下架狀態。
   ◦ 用途: 前台菜單顯示、後台管理。
3. Orders (訂單主檔):
   ◦ 儲存訂單 ID、顧客 ID、總金額、付款方式、訂單狀態 (關鍵欄位)、建立時間。
   ◦ 用途: 結帳記錄、營收統計、進度追蹤。
4. Order_Items (訂單明細):
   ◦ 儲存訂單 ID、商品 ID、數量、客製化參數 (JSON 格式: {sugar: "half", ice: "no"})、小計。
   ◦ 用途: 記錄每一杯飲料的具體做法。

--------------------------------------------------------------------------------
💡 自我稽核檢查 (Self-Audit Checklist)
為了確保這份 SA 與您之前的 SD 及 REQ 一致，請在提交前確認：
1. 一致性檢查 (Consistency Check):
   ◦ SA 中的 F4 結帳下單 邏輯，是否對應 SD 文件中的 POST /api/orders？
   ◦ SA 中的 B2 狀態管理 流程，是否對應 SD 文件中的 PATCH 更新狀態 API？
2. 流程具體化 (Flow Check):
   ◦ 上述「流程 P1」是否已包含 使用者、前端、後端、資料庫 四個層面的行為？(是，已列出 10 步驟)。
3. 資料表支援 (DB Check):
   ◦ REQ 中的「客製化選項 (F2)」是否有對應的資料結構？(是，在 Order_Items 中定義了客製化參數欄位)。
   此 SA 文件已準備好作為程式開發的邏輯藍圖，可配合 SD 進行實作。